---
import ProjectAddLink from "@/components/project-add-link";
import ProjectCard from "@/components/project-card";
import SearchForm from "@/components/search-form";
import AppLayout from "@/layouts/app-layout.astro";
import RootLayout from "@/layouts/root-layout.astro";
import { Heading } from "@radix-ui/themes";
import { actions } from "astro:actions";

const search = Astro.url.searchParams.get("search") ?? undefined;

const projects = await Astro.callAction(actions.projects.getAll.orThrow, {
  search,
});
---

<RootLayout>
  <AppLayout>
    <header class="flex items-center justify-between">
      <Heading size="8">Projects</Heading>
      <section class="flex items-center gap-3">
        <SearchForm search={search} url={Astro.url} />
        <ProjectAddLink />
      </section>
    </header>
    <section class="grid gap-4">
      {projects.map((project) => <ProjectCard project={project} />)}
    </section>
  </AppLayout></RootLayout
>
