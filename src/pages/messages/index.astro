---
import MessageTable from "@/components/message-table";
import SearchForm from "@/components/search-form";
import AppLayout from "@/layouts/app-layout.astro";
import RootLayout from "@/layouts/root-layout.astro";
import { Heading } from "@radix-ui/themes";
import { actions } from "astro:actions";

const pageParam = Astro.url.searchParams.get("page");
const page = pageParam ? parseInt(pageParam, 10) : 1;

const search = Astro.url.searchParams.get("search") ?? undefined;

const { messages, pagination } = await Astro.callAction(
  actions.messages.getAll.orThrow,
  { page, search },
);
---

<RootLayout>
  <AppLayout>
    <header class="flex items-center justify-between">
      <Heading size="8">Messages</Heading>
      <SearchForm search={search} url={Astro.url} />
    </header>
    <MessageTable messages={messages} pagination={pagination} url={Astro.url} />
  </AppLayout>
</RootLayout>
